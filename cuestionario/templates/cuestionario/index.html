{% extends "cuestionario/base.html" %}

{% block title %}Inicio - {{ trabajador.nombre }}{% endblock %}

{% block content %}
    <section class="perfil-usuario">
        <h2>Bienvenid@, {{ trabajador.nombre }} {{ trabajador.apellido_paterno }} {{ trabajador.apellido_materno }}</h2>
        <p><strong>Cargo:</strong> {{ trabajador.cargo.nombre_cargo }}</p>
        <p><strong>Departamento:</strong> {{ trabajador.departamento.nombre_departmento }}</p>
    </section>

    <hr>

    <section class="acciones-evaluacion">
        <div class="card autoevaluacion" style="padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h3>Mi Autoevaluación</h3>
            
            {% if ya_hizo_autoevaluacion %}
                <div style="background-color: #d4edda; color: #155724; padding: 15px; border-radius: 5px; border: 1px solid #c3e6cb; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">✅</span>
                    <span><strong>Proceso Completado:</strong> Ya has registrado tu autoevaluación para este periodo.</span>
                </div>
            {% else %}
                <p>Se han cargado <strong>{{ preguntas.count }}</strong> competencias para tu nivel: <em>{{ trabajador.nivel_jerarquico.nombre_nivel_jerarquico }}</em>.</p>
                <a href="{% url 'autoevaluacion' trabajador.id_trabajador %}" 
                   class="btn-evaluar" 
                   style="display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold;">
                   Comenzar mi Autoevaluación
                </a>
            {% endif %}
        </div>

        {% if es_jefe %}
        <div class="card equipo" style="border: 2px solid #2c3e50; margin-top: 20px; padding: 20px; border-radius: 8px;">
            <h3>Panel de Jefatura</h3>
            <p>Selecciona un colaborador para evaluar su desempeño:</p>
            <ul class="lista-equipo" style="list-style: none; padding: 0;">
                {% for subordinado in equipo %}
                <li style="margin-bottom: 10px; padding: 10px; background: #f9f9f9; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
                    <div>
                        <strong>{{ subordinado.nombre }} {{ subordinado.apellido_paterno }} {{ subordinado.apellido_materno }}</strong>
                        <br><small style="color: #666;">{{ subordinado.cargo.nombre_cargo }}</small>
                    </div>
                    
                    {% if subordinado.ya_evaluado %}
                        <span style="color: #28a745; font-weight: bold; background-color: #eaffea; padding: 6px 12px; border-radius: 20px; border: 1px solid #28a745; font-size: 0.85em;">
                            ✅ Evaluado
                        </span>
                    {% else %}
                        <a href="{% url 'evaluacion_jefe' trabajador.id_trabajador subordinado.id_trabajador %}" 
                           class="btn-subordinado" 
                           style="color: white; background-color: #28a745; text-decoration: none; font-weight: bold; padding: 8px 15px; border-radius: 5px; font-size: 0.9em;">
                            Evaluar Colaborador →
                        </a>
                    {% endif %}
                </li>
                {% empty %}
                    <li>No hay subordinados registrados.</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </section>

    <hr>

    <section class="detalle-preguntas" style="margin-top: 30px; opacity: 0.8; font-size: 0.9em;">
        <h4>Resumen de competencias a evaluar:</h4>
        <ul>
            {% for p in preguntas %}
                <li><strong>{{ p.codigo_excel }}:</strong> {{ p.competencia.nombre_competencia }}</li>
            {% endfor %}
        </ul>
    </section>
{% endblock %}