{% extends "cuestionario/base.html" %}

{% block title %}Inicio - {{ trabajador.nombre }}{% endblock %}

{% block content %}
    <section>
        <header>
            <h2>Bienvenid@, {{ trabajador.nombre }} {{ trabajador.apellido_paterno }}</h2>
            <p><strong>{{ trabajador.cargo.nombre_cargo }}</strong> | {{ trabajador.departamento.nombre_departmento }}</p>
        </header>
    </section>

    <div class="features">
        <section>
            <span class="icon solid major fa-user-check"></span>
            <h3>Mi Autoevaluación</h3>
            
            {% if ya_hizo_autoevaluacion %}
                <p style="color: #51ff85;">✅ <strong>Proceso Completado:</strong> Tu registro ya se encuentra en el sistema.</p>
            {% else %}
                <p>Tienes <strong>{{ preguntas.count }}</strong> competencias asignadas según tu nivel jerárquico.</p>
                <ul class="actions">
                    <li>
                        <a href="{% url 'autoevaluacion' trabajador.id_trabajador %}" class="button primary scrolly">
                            Comenzar ahora
                        </a>
                    </li>
                </ul>
            {% endif %}
        </section>

        <section>
            <span class="icon solid major fa-list-alt"></span>
            <h3>Competencias</h3>
            <p>Se evaluarán áreas como: 
                {% for p in preguntas|slice:":3" %}
                    <em>{{ p.competencia.nombre_competencia }}</em>{% if not forloop.last %}, {% endif %}
                {% endfor %}...
            </p>
        </section>
    </div>

    {% if es_jefe %}
    <section id="jefatura" class="wrapper style2 spotlights" style="margin-top: 2em; border-radius: 10px; overflow: hidden;">
        <section>
            <div class="content">
                <div class="inner">
                    <h2>Panel de Jefatura</h2>
                    <p>Gestiona la evaluación de desempeño de tu equipo directo:</p>
                    
                    <div class="table-wrapper">
                        <table class="alt">
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Cargo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subordinado in equipo %}
                                <tr>
                                    <td>{{ subordinado.nombre }} {{ subordinado.apellido_paterno }}</td>
                                    <td>{{ subordinado.cargo.nombre_cargo }}</td>
                                    <td>
                                        {% if subordinado.ya_evaluado %}
                                            <span style="color: #51ff85; font-weight: bold;">✅ Finalizado</span>
                                        {% else %}
                                            <a href="{% url 'evaluacion_jefe' trabajador.id_trabajador subordinado.id_trabajador %}" class="button small">
                                                Evaluar →
                                            </a>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="3">No hay subordinados asignados.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </section>
    {% endif %}

{% endblock %}